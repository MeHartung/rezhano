#Параметры доступа к БД
source lsParentSource
{
  type                = mysql
  sql_host            = 127.0.0.1
  sql_user            = root
  sql_pass            = 
  sql_db              = nvi
  sql_port            = 3306

  mysql_connect_flags = 32 # 32 - включение сжатие при обмене данными с БД

  # Включам нужную кодировку соединения и выключаем кеш запросов
  sql_query_pre       = SET NAMES utf8
  #sql_query_pre       = SET SESSION query_cache_type=OFF
}

source productSource : lsParentSource
{
  sql_query               = \
         SELECT products.ID, products.NAME AS name, products.SKU as sku, 1 as source_id, \
            products.published as published, FALSE AS is_deleted\
         FROM products \
         WHERE \
            products.id>=$start AND products.id<=$end \
         ORDER BY name

  sql_query_range         = SELECT MIN(id),MAX(id) FROM products

  # сколько получать объектов за итерацию
  sql_range_step          = 1000

  sql_ranged_throttle     = 0

  sql_attr_uint = source_id
  sql_attr_bool = published
  sql_attr_bool = is_deleted
}

source taxonSource: lsParentSource
{
  sql_query               = \
         SELECT `catalog_sections`.`id`, `catalog_sections`.`name`, 2 as source_id \
         FROM `catalog_sections` \
         WHERE `catalog_sections`.`id` >= $start AND `catalog_sections`.`id` <= $end \
  ORDER BY name

  sql_query_range         = SELECT MIN(`catalog_sections`.`id`), MAX(`catalog_sections`.`id`) FROM `catalog_sections`

  # сколько получать объектов за итерацию
  sql_range_step          = 1000

  sql_ranged_throttle     = 0

  sql_attr_uint = source_id
}

index productIndex
{
        # Источник, который будет хранить данный индекса
        source                  = productSource
        path                    = d:/dev/gpn_nvi/var/sphinx/indices/product

        mlock                   = 0

        # Используемые морфологические движки
        # morphology              = stem_en, stem_ru

        # Из данных источника HTML-код нужно вырезать
        html_strip              = 1

        #поиск по частям
        min_infix_len = 2

        index_exact_words = 1

        expand_keywords = 1

        #Замена ё, Ё на е (U+401->U+0435, U+451->U+435)
        #Замена ъ, Ъ на ь ()
        charset_table = 0..9, A..Z->a..z, _, a..z, ., -, U+002C, \
            U+401->U+0435, U+410..U+429->U+430..U+449, U+42A->U+44C, U+42B->U+44B, U+42C..U+42F->U+44C..U+44F, U+430..U+449, \
            U+44A->U+44C, U+44B..U+44F, U+451->U+435, \
            U+002A
}

index taxonIndex
{
        # Источник, который будет хранить данный индекса
        source                  = taxonSource
        path                    = d:/dev/gpn_nvi/var/sphinx/indices/taxon


        mlock                   = 0

        # Используемые морфологические движки
        morphology              = stem_en, stem_ru

        # Из данных источника HTML-код нужно вырезать
        html_strip              = 1

        #поиск по частям
        min_infix_len = 2

        index_exact_words = 1

        expand_keywords = 1

        #Замена ё, Ё на е (U+401->U+0435, U+451->U+435)
        #Замена ъ, Ъ на ь ()
        charset_table = 0..9, A..Z->a..z, _, a..z, ., -, U+002C, \
            U+401->U+0435, U+410..U+429->U+430..U+449, U+42A->U+44C, U+42B->U+44B, U+42C..U+42F->U+44C..U+44F, U+430..U+449, \
            U+44A->U+44C, U+44B..U+44F, U+451->U+435, \
            U+002A
}

indexer
{
  # Лимит памяти, который может использавать демон-индексатор
  mem_limit = 128M
}

searchd
{
  # Адрес, на котором будет прослушиваться порт
  listen       = localhost:9312

  # Лог-файл демона
  log          = d:/dev/gpn_nvi/var/logs/sphinx/searchd.log
  binlog_path  = d:/dev/gpn_nvi/var/logs/sphinx/binlog

  # Лог поисковых запросов. Если закомментировать,то логировать поисковые строки не будет
  query_log    = d:/dev/gpn_nvi/var/logs/sphinx/query.log

  # Время в секундах, которое ждет демон при обмене данными с клиентом. По исчерпании происходит разрыв коннекта
  read_timeout = 5

  # Максимальное количество одновременно-обрабатываемых запросов. 0 означает дофига, а точнее без ограничения
  max_children = 30
  max_matches  = 10000

  # Файл, в который сохраняется PID-процесса при запуске
  pid_file     = d:/dev/gpn_nvi/var/logs/sphinx/searchd.pid
}